@page "/"
@page "/catalogo"

@inject IProductService _productService
@inject ICategoryService _categoryService
@inject NavigationManager _navServicio

<!--Forms Search-->
<section class="row justify-content-center mt-3 mb-4">

    <div class="col-sm-6 col-md-8 col-xl-9">

        <div class="input-group mb-3">

            <input type="text" class="form-control" placeholder="Buscar producto..." @bind-value="search">

            <button class="btn btn-primary" type="button" @onclick="(async () => await ObtainCatalog())">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
                    <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0" />
                </svg>
            </button>

        </div>

    </div>

</section>

<!--Banners-->
<section id="carouselExample" class="carousel slide w-100 mb-4">
    <div class="carousel-inner">
        <div class="carousel-item active">
            <img src="images/banner-one.png" class="d-block w-100" alt="banner uno">
        </div>
        <div class="carousel-item">
            <img src="images/banner-two.png" class="d-block w-100" alt="banner dos">
        </div>
        <div class="carousel-item">
            <img src="images/banner-three.png" class="d-block w-100" alt="banner tres">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExample" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExample" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
</section>


<section class="row d-flex justify-content-center align-items-center gap-3 mb-5 mt-5">

    <article class="card text-bg-primary mb-3" style="max-width: 18rem;">
        <header class="card-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tags" viewBox="0 0 16 16">
                <path d="M3 2v4.586l7 7L14.586 9l-7-7zM2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586z" />
                <path d="M5.5 5a.5.5 0 1 1 0-1 .5.5 0 0 1 0 1m0 1a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3M1 7.086a1 1 0 0 0 .293.707L8.75 15.25l-.043.043a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 0 7.586V3a1 1 0 0 1 1-1z" />
            </svg>
        </header>
        <main class="card-body">
            <h5 class="card-title">Compra Segura</h5>
            <p class="card-text">Compra desde nuestra tienda online y accede al catalogo mayorista al dia con los mejores precios del mercado y garantia en todos los productos.</p>
        </main>
    </article>

    <article class="card text-bg-primary mb-3" style="max-width: 18rem;">
        <header class="card-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-truck" viewBox="0 0 16 16">
                <path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-3.998-.085A1.5 1.5 0 0 1 0 10.5zm1.294 7.456A2 2 0 0 1 4.732 11h5.536a2 2 0 0 1 .732-.732V3.5a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v7a.5.5 0 0 0 .294.456M12 10a2 2 0 0 1 1.732 1h.768a.5.5 0 0 0 .5-.5V8.35a.5.5 0 0 0-.11-.312l-1.48-1.85A.5.5 0 0 0 13.02 6H12zm-9 1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m9 0a1 1 0 1 0 0 2 1 1 0 0 0 0-2" />
            </svg>
        </header>
        <main class="card-body">
            <h5 class="card-title">Entrega Inmediata</h5>
            <p class="card-text">Entregamos el pedido de forma inmediata sin cargo en compra superiores a $200.000 y puedes pagar cuando tengas los productos en mano</p>
        </main>
    </article>

    <article class="card text-bg-primary mb-3" style="max-width: 18rem;">
        <header class="card-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-telephone" viewBox="0 0 16 16">
                <path d="M3.654 1.328a.678.678 0 0 0-1.015-.063L1.605 2.3c-.483.484-.661 1.169-.45 1.77a17.6 17.6 0 0 0 4.168 6.608 17.6 17.6 0 0 0 6.608 4.168c.601.211 1.286.033 1.77-.45l1.034-1.034a.678.678 0 0 0-.063-1.015l-2.307-1.794a.68.68 0 0 0-.58-.122l-2.19.547a1.75 1.75 0 0 1-1.657-.459L5.482 8.062a1.75 1.75 0 0 1-.46-1.657l.548-2.19a.68.68 0 0 0-.122-.58zM1.884.511a1.745 1.745 0 0 1 2.612.163L6.29 2.98c.329.423.445.974.315 1.494l-.547 2.19a.68.68 0 0 0 .178.643l2.457 2.457a.68.68 0 0 0 .644.178l2.189-.547a1.75 1.75 0 0 1 1.494.315l2.306 1.794c.829.645.905 1.87.163 2.611l-1.034 1.034c-.74.74-1.846 1.065-2.877.702a18.6 18.6 0 0 1-7.01-4.42 18.6 18.6 0 0 1-4.42-7.009c-.362-1.03-.037-2.137.703-2.877z" />
            </svg>
        </header>
        <main class="card-body">
            <h5 class="card-title">Atencion Preferencial</h5>
            <p class="card-text">Contamos con un equipo especializado en resolver tus dudas y consultas por WhatsApp, via telefonica o nuestras redes sociales.</p>
        </main>
    </article>

</section>

<!--Catalog-->
<section class="row">

    
   <aside class="col-sm-3 mb-5">

        <article class="card">
                <div class="card-header text-white bg-primary">
                    Categorias
                </div>
                <div class="card-body">
                    @if (listCategory != null)
                    {
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="categoria" id="Todos" value="Todos"
                                   @onchange="RadioSeleccion"
                                   checked=@(selectedCategory.Equals("Todos"))>
                            <label class="form-check-label" for="Todos">
                                Todos
                            </label>
                        </div>

                        @foreach (var item in listCategory)
                        {
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="categoria" id="@item.IdCategory" value="@item.Name"
                                       @onchange="RadioSeleccion"
                                       checked=@(selectedCategory.Equals(item.Name, StringComparison.OrdinalIgnoreCase))>
                                <label class="form-check-label" for="@item.IdCategory">
                                    @item.Name
                                </label>
                            </div>
                        }
                    }
                    else
                    {
                        <div class="d-flex align-items-center">
                            <strong role="status">Cargando...</strong>
                            <div class="spinner-border ms-auto" aria-hidden="true"></div>
                        </div>
                    }
                </div>

            </article>

   </aside>
    

    <section class="col-sm-9">
        <section class="d-flex justify-content-start align-items-center gap-3 flex-wrap">
            @if (listProduct != null)
            {
                @foreach (var item in listProduct)
                {
                    <article class="col mb-4" style="height: 390px !important ;">

                        <article class="card d-flex flex-column justify-content-center align-items-center w-100" style="height: 370px !important ;">
                            <!-- Sale badge-->
                            @if (DateTime.Now < item.CreatedAt.Value.AddDays(30))
                            {
                                <div class="badge bg-primary text-white position-absolute" style="top: 0.5rem; right: 0.5rem">Nuevo</div>
                            }

                            <!-- Product image-->
                            <figure class="card-img-top border-light border-1 d-flex justify-content-center align-items-center" style="width: 170px; height: 170px;">
                                <img class="w-100 h-100 object-fit-cover" src="@item.ImageUrl">
                            </figure>
                            <!-- Product details-->
                            <main class="card-body p-3">
                                <div class="text-start">
                                    <!-- Product name-->
                                    <h5 class="fs-6 fw-semibold mb-3">@item.Name</h5>
                                    <!-- Product price-->
                                    @if (item.SalePrice != 0 && item.SalePrice < item.Price)
                                    {
                                        <div class="w-100 d-flex justify-content-start align-items-center ">
                                            <p class="text-danger fs-5 fw-light text-decoration-line-through mb-0 me-2">$@Convert.ToInt32(item.Price)</p>

                                            <p class="text-dark fs-5 fw-medium mb-0">
                                                $@Convert.ToInt32(item.SalePrice)
                                            </p>
                                        </div>    
                                    }
                                    else
                                    {
                                        <p class="text-dark mb-0 fs-5 fw-medium">$@Convert.ToInt32(item.Price)</p>
                                    }
                                </div>
                            </main>
                            <!-- Product actions-->
                            <footer class="card-footer w-100 ps-3 pb-3 pe-3 pt-0 border-top-0 bg-transparent">
                                <div class="text-start">
                                    <a class="btn btn-outline-primary mt-auto" href="/detalle/@item.IdProduct">Ver más</a>
                                </div>
                            </footer>
                        </article>

                    </article>
                }
            }
            else
            {
                <div class="d-flex align-items-center">
                    <strong role="status">Cargando...</strong>
                    <div class="spinner-border ms-auto" aria-hidden="true"></div>
                </div>
            }
        </section>
    </section>
</section>

@code {
    private List<CategoryDTO>? listCategory = null;
    private List<ProductDTO>? listProduct = null;
    private string search = "";
    private string selectedCategory = "Todos";

    private async Task ObtainCatalog()
    {
        var response = await _productService.Catalog(selectedCategory, search);
        if (response.IsCorrect)
        {
            listProduct = (List<ProductDTO>)response.Result!;
        }
        else
        {
            listProduct = new List<ProductDTO>();
        }
    }

    private async Task ObtainCategory(string value = "")
    {
        var response = await _categoryService.List(value);
        if (response.IsCorrect)
        {
            listCategory = (List<CategoryDTO>)response.Result!;
        }
        else
        {
            listCategory = new List<CategoryDTO>();
        }
    }

    private async Task RadioSeleccion(ChangeEventArgs args)
    {
        selectedCategory = args.Value.ToString();
        search = "";
        await ObtainCatalog();
    }

    protected override async Task OnInitializedAsync()
    {
        await ObtainCategory();
        await ObtainCatalog();
    }
}
