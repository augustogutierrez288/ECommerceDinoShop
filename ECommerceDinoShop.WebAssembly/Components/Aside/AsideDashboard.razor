@using System.Security.Claims;
@using ECommerceDinoShop.WebAssembly.Extensions;
@using Microsoft.AspNetCore.Components.Authorization;

@inject SweetAlertService Swal;
@inject NavigationManager navigationManager;
@inject AuthenticationStateProvider _authenticationProvider

<AuthorizeView Roles="Administrador">
    <Authorized>
        <aside class="col-2 aside-dashboard">
            <section class="aside-dashboard-section-avatar">
                <img class="avatar-user" src="https://marketplace.canva.com/EAFmXbWjG3g/1/0/1600w/canva-avatar-foto-de-perfil-hombre-dibujo-ilustrado-moderno-morado-YQVjZm4iPII.jpg" alt="avatar del usuario" />
                <h4 class="name-user">
                    @context.User.Claims.Where(c => c.Type == ClaimTypes.Name).Select(c => c.Value).SingleOrDefault()
                </h4>
                <h5 class="email-user">
                    @context.User.Claims.Where(c => c.Type == ClaimTypes.Email).Select(c => c.Value).SingleOrDefault()
                </h5>
            </section>

            <section class="aside-dashboard-section">
                <h4 class="title-aside">Administracion</h4>
                <h5 class="subtitle-aside">
                    Base de datos
                </h5>
                <div>
                    <NavLink class="btn-aside" href="dashboard/productos">
                        <div class="icon-svg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-fill" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M15.528 2.973a.75.75 0 0 1 .472.696v8.662a.75.75 0 0 1-.472.696l-7.25 2.9a.75.75 0 0 1-.557 0l-7.25-2.9A.75.75 0 0 1 0 12.331V3.669a.75.75 0 0 1 .471-.696L7.443.184l.004-.001.274-.11a.75.75 0 0 1 .558 0l.274.11.004.001zm-1.374.527L8 5.962 1.846 3.5 1 3.839v.4l6.5 2.6v7.922l.5.2.5-.2V6.84l6.5-2.6v-.4l-.846-.339Z" />
                            </svg>
                        </div>
                        Productos
                    </NavLink>

                    <NavLink class="btn-aside" href="dashboard/categorias">
                        <div class="icon-svg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-tags-fill" viewBox="0 0 16 16">
                                <path d="M2 2a1 1 0 0 1 1-1h4.586a1 1 0 0 1 .707.293l7 7a1 1 0 0 1 0 1.414l-4.586 4.586a1 1 0 0 1-1.414 0l-7-7A1 1 0 0 1 2 6.586zm3.5 4a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" />
                                <path d="M1.293 7.793A1 1 0 0 1 1 7.086V2a1 1 0 0 0-1 1v4.586a1 1 0 0 0 .293.707l7 7a1 1 0 0 0 1.414 0l.043-.043z" />
                            </svg>
                        </div>
                        Categorias
                    </NavLink>

                    <NavLink class="btn-aside" href="dashboard/usuarios">
                        <div class="icon-svg">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-people-fill" viewBox="0 0 16 16">
                                <path d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5.784 6A2.24 2.24 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.3 6.3 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1zM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5" />
                            </svg>
                        </div>
                        Usuarios
                    </NavLink>
                </div>
            </section>

            <section class="aside-dashboard-section">
                <button class="btn-logaut" type="button" @onclick="Logout">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                        <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z" />
                        <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z" />
                    </svg>
                    Salir
                </button>
            </section>
        </aside>
    </Authorized>
    <NotAuthorized>
        <aside class="col-2 aside-dashboard">
            <section class="aside-dashboard-section-avatar">
                <img class="avatar-user" src="https://marketplace.canva.com/EAFmXbWjG3g/1/0/1600w/canva-avatar-foto-de-perfil-hombre-dibujo-ilustrado-moderno-morado-YQVjZm4iPII.jpg" alt="avatar del usuario" />
                <h4 class="name-user">Invitado</h4>
                <h5 class="email-user"></h5>
            </section>
        </aside>
    </NotAuthorized>
</AuthorizeView>

@code{
    private async Task Logout()
    {
        SweetAlertResult result = await Swal.FireAsync(new SweetAlertOptions
        {
            Title = "¿Estas seguro?",
            Icon = SweetAlertIcon.Warning,
            ShowCancelButton = true,
            ConfirmButtonText = "Si",
            CancelButtonText = "No"
        });

        if (result.IsConfirmed)
        {
            var autenticacionExt = (AuthenticationExtension)_authenticationProvider;
            await autenticacionExt.UpdateAuthenticationStatus(null);
            navigationManager.NavigateTo("/", true);
        }
    }
}